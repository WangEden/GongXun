
[python+OpenCV 实时测量相机位姿（相机外参）]{https://zhuanlan.zhihu.com/p/621839626}

这个 `calibration` 函数的主要目的是进行相机标定，以确定相机的内部参数和畸变参数，以下是函数中每个小模块的功能和作用的详细解释：

1. `criteria` 定义：
   
   这一部分定义了用于角点精确化的标准。`criteria` 是一个包含三个元素的元组，其中：
   - `cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER` 表示标准是基于最大迭代次数和迭代的误差（epsilon）。
   - `30` 是最大迭代次数。
   - `0.001` 是迭代的误差阈值。

2. `w` 和 `h` 定义：
   
   这两个变量表示棋盘格的长边和短边规格，即棋盘格内角点的行数和列数。

3. `objp` 定义：

   这是一个存储棋盘格角点的世界坐标的数组。它是一个 88 行 3 列的二维 NumPy 数组，用于存储每个角点的三维坐标。Z 坐标被设置为 0，因为棋盘格被认为在一个平面上。

4. `objp[:, :2]` 设置：

   这一行代码使用 `np.mgrid` 函数生成一个三维网格坐标，并将其转换为一个二维数组，以便与 `objp` 中的坐标对应。这样，`objp` 数组将包含棋盘格角点的二维坐标。

5. `objpoints` 和 `imgpoints` 初始化：

   这两个列表用于分别存储在世界坐标系中的三维点和在图像平面上的二维点。它们将用于存储找到的棋盘格角点的坐标。

6. 图像文件的读取和处理：

   - 使用 `glob.glob` 查找指定文件夹下的所有图像文件。
   - 使用 `cv_imread` 函数读取每个图像文件，并将其转换为灰度图像。
   - 使用 `cv2.findChessboardCorners` 函数在灰度图像中查找棋盘格角点，如果找到足够的角点对，将其存储在 `objpoints` 和 `imgpoints` 中。
   - 使用 `cv2.cornerSubPix` 函数精确找到角点坐标，并将角点在图像上显示。

7. 相机标定：

   - 使用 `cv2.calibrateCamera` 函数进行相机标定，该函数返回相机的内部参数（`mtx`）、畸变参数（`dist`）、旋转向量（`rvecs`）、平移向量（`tvecs`）等信息。

8. 图像去畸变：

   - 读取另一张图像，这张图像将用于演示去畸变的效果。
   - 使用 `cv2.getOptimalNewCameraMatrix` 函数计算新的相机矩阵 `newcameramtx`，以及感兴趣区域（ROI）。
   - 使用 `cv2.undistort` 函数对输入图像进行去畸变，得到 `dst` 图像。
   - 最后，通过 `cv2.imshow` 显示去畸变后的图像。

9. 反投影误差计算：

   - 使用循环遍历每个标定板图像，对每个标定板计算反投影误差。
   - 使用 `cv2.projectPoints` 函数将世界坐标点投影到图像平面上，然后计算投影点与实际检测到的图像点之间的误差。
   - 累积误差并计算平均误差，最后打印出来。

10. 打印结果：

   - 打印出相机的内部参数 `newcameramtx` 和畸变参数 `dist`。
   - 打印旋转向量 `rvecs` 和平移向量 `tvecs`，这些是相机的外部参数。
   - 打印感兴趣区域 `roi`，这表示在去畸变后的图像中的有效区域。

这个函数的核心工作是进行相机标定，并提取相机参数以进行图像去畸变，最后评估标定的准确性。这些参数对于后续的计算机视觉应用非常重要。